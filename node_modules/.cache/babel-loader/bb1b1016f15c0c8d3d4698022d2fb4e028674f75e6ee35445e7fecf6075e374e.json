{"ast":null,"code":"import _regeneratorRuntime from\"C:/Users/liranhaim/Desktop/MotoProg_H/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"C:/Users/liranhaim/Desktop/MotoProg_H/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import{createSlice,createAsyncThunk}from\"@reduxjs/toolkit\";import{getDoc,setDoc,doc,updateDoc,getDocs,collection,where}from\"firebase/firestore\";import{firestore}from\"../firebase\";export var getRating=createAsyncThunk(\"appQuestions/getRating\",/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(questionId){var snap;return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:_context.next=2;return getDoc(doc(firestore,\"ratings\",questionId));case 2:snap=_context.sent;return _context.abrupt(\"return\",snap.data()===undefined?{questionId:questionId,userRate:[],ratesCount:0,ratesSum:0}:snap.data());case 4:case\"end\":return _context.stop();}},_callee);}));return function(_x){return _ref.apply(this,arguments);};}());export var addRating=createAsyncThunk(\"appQuestions/createRating\",/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(data){return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1)switch(_context2.prev=_context2.next){case 0:_context2.next=2;return setDoc(doc(firestore,\"ratings\",data.questionId),{questionId:data.questionId,userRate:data.userRate,ratesCount:data.ratesCount,ratesSum:data.ratesSum});case 2:return _context2.abrupt(\"return\",{questionId:data.questionId,userRate:data.userRate,ratesCount:data.ratesCount,ratesSum:data.ratesSum});case 3:case\"end\":return _context2.stop();}},_callee2);}));return function(_x2){return _ref2.apply(this,arguments);};}());export var updateRating=createAsyncThunk(\"appQuestions/updateRating\",/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee3(data,_ref3){var dispatch;return _regeneratorRuntime().wrap(function _callee3$(_context3){while(1)switch(_context3.prev=_context3.next){case 0:dispatch=_ref3.dispatch;_context3.next=3;return updateDoc(doc(firestore,\"ratings\",data.questionId),{userRate:data.userRate,ratesCount:data.ratesCount,ratesSum:data.ratesSum});case 3:dispatch(getRating(data.id));case 4:case\"end\":return _context3.stop();}},_callee3);}));return function(_x3,_x4){return _ref4.apply(this,arguments);};}());export var Slice=createSlice({name:\"Ratings\",initialState:{questionId:\"\",userRate:[],ratesCount:0,ratesSum:0},reducers:{},extraReducers:function extraReducers(builder){builder.addCase(addRating.fulfilled,function(state,action){state.questionId=action.payload.questionId;state.userRate=action.payload.userRate;state.ratesCount=action.payload.ratesCount;state.ratesSum=action.payload.ratesSum;}).addCase(getRating.fulfilled,function(state,action){state.questionId=action.payload.questionId;state.userRate=action.payload.userRate;state.ratesCount=action.payload.ratesCount;state.ratesSum=action.payload.ratesSum;});}});export default Slice.reducer;","map":{"version":3,"names":["createSlice","createAsyncThunk","getDoc","setDoc","doc","updateDoc","getDocs","collection","where","firestore","getRating","questionId","snap","data","undefined","userRate","ratesCount","ratesSum","addRating","updateRating","dispatch","id","Slice","name","initialState","reducers","extraReducers","builder","addCase","fulfilled","state","action","payload","reducer"],"sources":["C:/Users/liranhaim/Desktop/MotoProg_H/src/features/rating.js"],"sourcesContent":["import { createSlice, createAsyncThunk } from \"@reduxjs/toolkit\";\nimport {\n  getDoc,\n  setDoc,\n  doc,\n  updateDoc,\n  getDocs,\n  collection,\n  where,\n} from \"firebase/firestore\";\nimport { firestore } from \"../firebase\";\n\nexport const getRating = createAsyncThunk(\n  \"appQuestions/getRating\",\n  async (questionId) => {\n    const snap = await getDoc(doc(firestore, \"ratings\", questionId)); //questionId)) // TODO: change to questionId\n    // console.log(\"getRating => \", snap.data())\n    // localStorage.setItem(\"user\", JSON.stringify({id:id, ...snap.data()}))\n    return snap.data() === undefined\n      ? {\n          questionId: questionId,\n          userRate: [],\n          ratesCount: 0,\n          ratesSum: 0,\n        }\n      : snap.data();\n  }\n);\n\nexport const addRating = createAsyncThunk(\n  \"appQuestions/createRating\",\n  async (data) => {\n    await setDoc(doc(firestore, \"ratings\", data.questionId), {\n      questionId: data.questionId,\n      userRate: data.userRate,\n      ratesCount: data.ratesCount,\n      ratesSum: data.ratesSum,\n    });\n    return {\n      questionId: data.questionId,\n      userRate: data.userRate,\n      ratesCount: data.ratesCount,\n      ratesSum: data.ratesSum,\n    };\n  }\n);\n\nexport const updateRating = createAsyncThunk(\n  \"appQuestions/updateRating\",\n  async (data, { dispatch }) => {\n    await updateDoc(doc(firestore, \"ratings\", data.questionId), {\n      userRate: data.userRate,\n      ratesCount: data.ratesCount,\n      ratesSum: data.ratesSum,\n    });\n    dispatch(getRating(data.id));\n  }\n);\n\nexport const Slice = createSlice({\n  name: \"Ratings\",\n  initialState: {\n    questionId: \"\",\n    userRate: [],\n    ratesCount: 0,\n    ratesSum: 0,\n  },\n  reducers: {},\n  extraReducers: (builder) => {\n    builder\n      .addCase(addRating.fulfilled, (state, action) => {\n        state.questionId = action.payload.questionId;\n        state.userRate = action.payload.userRate;\n        state.ratesCount = action.payload.ratesCount;\n        state.ratesSum = action.payload.ratesSum;\n      })\n      .addCase(getRating.fulfilled, (state, action) => {\n        state.questionId = action.payload.questionId;\n        state.userRate = action.payload.userRate;\n        state.ratesCount = action.payload.ratesCount;\n        state.ratesSum = action.payload.ratesSum;\n      });\n  },\n});\n\nexport default Slice.reducer;\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}