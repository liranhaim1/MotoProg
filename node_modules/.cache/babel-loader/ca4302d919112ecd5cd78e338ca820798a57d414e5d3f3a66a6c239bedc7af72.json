{"ast":null,"code":"import _regeneratorRuntime from\"C:/Users/liranhaim/Desktop/MotoProg_H/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _objectSpread from\"C:/Users/liranhaim/Desktop/MotoProg_H/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _asyncToGenerator from\"C:/Users/liranhaim/Desktop/MotoProg_H/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import{createSlice,createAsyncThunk}from'@reduxjs/toolkit';import{getDoc,setDoc,doc,updateDoc}from'firebase/firestore';import{firestore}from'../firebase';export var getUser=createAsyncThunk(\"appUsers/getUser\",/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(id){var snap;return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:_context.next=2;return getDoc(doc(firestore,'users',id));case 2:snap=_context.sent;localStorage.setItem(\"user\",JSON.stringify(_objectSpread({id:id},snap.data())));return _context.abrupt(\"return\",_objectSpread({id:id},snap.data()));case 5:case\"end\":return _context.stop();}},_callee);}));return function(_x){return _ref.apply(this,arguments);};}());export var setUser=createAsyncThunk(\"appUsers/setUser\",/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(data){return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1)switch(_context2.prev=_context2.next){case 0:return _context2.abrupt(\"return\",{id:data.id,email:data.email,ids:data.ids,questionsHistory:data.questionsHistory});case 1:case\"end\":return _context2.stop();}},_callee2);}));return function(_x2){return _ref2.apply(this,arguments);};}());export var addUser=createAsyncThunk(\"appUsers/createUser\",/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee3(data,_ref3){var dispatch;return _regeneratorRuntime().wrap(function _callee3$(_context3){while(1)switch(_context3.prev=_context3.next){case 0:dispatch=_ref3.dispatch;_context3.next=3;return setDoc(doc(firestore,'users',data.uid),{email:data.email,ids:[],questionsHistory:{}});case 3:return _context3.abrupt(\"return\",{id:data.uid,email:data.email,ids:[],questionsHistory:{}});case 4:case\"end\":return _context3.stop();}},_callee3);}));return function(_x3,_x4){return _ref4.apply(this,arguments);};}());export var updateUser=createAsyncThunk(\"appUsers/updateUser\",/*#__PURE__*/function(){var _ref6=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee4(data,_ref5){var dispatch;return _regeneratorRuntime().wrap(function _callee4$(_context4){while(1)switch(_context4.prev=_context4.next){case 0:dispatch=_ref5.dispatch;console.log(\"data.ids => \",data.ids);_context4.next=4;return updateDoc(doc(firestore,'users',data.id),{ids:data.ids,questionsHistory:data.questionsHistory});case 4:dispatch(getUser(data.id));case 5:case\"end\":return _context4.stop();}},_callee4);}));return function(_x5,_x6){return _ref6.apply(this,arguments);};}());export var Slice=createSlice({name:\"Users\",initialState:{id:\"\",email:\"\",ids:[],questionsHistory:{}},reducers:{},extraReducers:function extraReducers(builder){builder.addCase(getUser.fulfilled,function(state,action){state.id=action.payload.id;state.email=action.payload.email;state.ids=action.payload.ids;state.questionsHistory=action.payload.questionsHistory;}).addCase(setUser.fulfilled,function(state,action){state.id=action.payload.id;state.email=action.payload.email;state.ids=action.payload.ids;state.questionsHistory=action.payload.questionsHistory;}).addCase(addUser.fulfilled,function(state,action){state.id=action.payload.id;state.email=action.payload.email;state.ids=action.payload.ids;state.questionsHistory=action.payload.questionsHistory;});}});export default Slice.reducer;","map":{"version":3,"names":["createSlice","createAsyncThunk","getDoc","setDoc","doc","updateDoc","firestore","getUser","id","snap","localStorage","setItem","JSON","stringify","data","setUser","email","ids","questionsHistory","addUser","dispatch","uid","updateUser","console","log","Slice","name","initialState","reducers","extraReducers","builder","addCase","fulfilled","state","action","payload","reducer"],"sources":["C:/Users/liranhaim/Desktop/MotoProg_H/src/features/users.js"],"sourcesContent":["import { createSlice, createAsyncThunk } from '@reduxjs/toolkit';\nimport { getDoc, setDoc, doc, updateDoc } from 'firebase/firestore';\nimport { firestore } from '../firebase';\n\nexport const getUser = createAsyncThunk(\"appUsers/getUser\", async (id) => {\n    const snap = await getDoc(doc(firestore, 'users', id))\n    localStorage.setItem(\"user\", JSON.stringify({id:id, ...snap.data()}))\n    return {\n        id: id,\n        ...snap.data()\n    }\n})\n\nexport const setUser = createAsyncThunk(\"appUsers/setUser\", async (data) => {\n    return {\n        id: data.id,\n        email: data.email,\n        ids: data.ids,\n        questionsHistory: data.questionsHistory,\n    }\n})\n\nexport const addUser = createAsyncThunk(\"appUsers/createUser\", async (data, {dispatch}) => {\n    await setDoc(doc(firestore, 'users', data.uid), {\n        email: data.email,\n        ids: [],\n        questionsHistory: {},\n    });\n    return {\n        id: data.uid,\n        email: data.email,\n        ids: [],\n        questionsHistory: {},\n    }\n})\n\nexport const updateUser = createAsyncThunk(\"appUsers/updateUser\", async (data, {dispatch}) => {\n    console.log(\"data.ids => \", data.ids)\n    await updateDoc(doc(firestore, 'users', data.id), {\n        ids: data.ids,\n        questionsHistory: data.questionsHistory,\n    })\n    dispatch(getUser(data.id))\n})\n\nexport const Slice = createSlice({\n    name: \"Users\",\n    initialState: {\n        id: \"\",\n        email: \"\",\n        ids: [],\n        questionsHistory: {},\n    },\n    reducers: {},\n    extraReducers: builder => {\n        builder\n            .addCase(getUser.fulfilled, (state, action) => {\n                state.id = action.payload.id\n                state.email = action.payload.email\n                state.ids = action.payload.ids\n                state.questionsHistory = action.payload.questionsHistory\n            })\n            .addCase(setUser.fulfilled, (state, action) => {\n                state.id = action.payload.id\n                state.email = action.payload.email\n                state.ids = action.payload.ids\n                state.questionsHistory = action.payload.questionsHistory\n            })\n            .addCase(addUser.fulfilled, (state, action) => {\n                state.id = action.payload.id\n                state.email = action.payload.email\n                state.ids = action.payload.ids\n                state.questionsHistory = action.payload.questionsHistory\n            })\n    }\n})\n\nexport default Slice.reducer;"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}